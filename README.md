# iotdb-extract
Extract text articles from newspapers


## Commands

All commands are found in the folder and are run e.g. `node extract.js`

### Extract

Extract structured data from an HTML document, using rules.

	usage: extract [options]

	Extract structured data from an HTML document, using rules.
	
    Source options:
    
    One of these is required. If used together, the document will
    be read from the file, but the url is assumed to be the source
    of the file - this is useful in case, e.g. in looking up rules..
    
    --url <url>     url to extract from
    --file <file>   file to extract from
    
    Rule options:
    
    If --rule is specified, the rules in that file will
    be used for better or for worse. If --rules is specified, all the
    rules in that folder will be used (narrowed by --url). If neither is
    specified, the default rules will be which handle a few well-known
    news sites (e.g. cnn, cbc, bbc)
    
    --rules <folder> load 
    --rule <file>    read the parsing rule from this file
    
    Output options (by default, output is YAML):
    
    --first          only output the first result
    --json           output the data as JSON
    --jsonl          output the data as JSON Lines
    --as <type>      as a schema.org type in JSON-LD (as much as possible)
    
    Debugging info:
    
    --verbose        increase debugging information
    --no-cache       don't cache URL fetch
    
Try this example:

	node extract --url 'https://grapevine.is/mag/feature/2019/07/19/of-monsters-and-men-fever-dream/'



### Analyze
### Validate

## Rules

### Broken Rule

Here's an example of an autogenerated rule that doesn't work

	URL='https://www.upi.com/Science_News/2020/11/04/Small-rocket-company-Rocket-Lab-	aims-for-orbital-reusability/3961604426951/' 
    node analyze -url $URL --rule rule.yaml 
    cat rule.yaml
    
Which looks like
    
    apiVersion: extract/v1
    urls: upi.com
    samples:
      - >-
        https://www.upi.com/Science_News/2020/11/04/Small-rocket-company-Rocket-Lab-aims-for-orbital-reusability/3961604426951/
    extract:
      document:
        select: article div.upi-slider.story_sl
        content: p
      name:
        select: 'script[type="application/ld+json"]'
        jsonld: headline
        list: false
        first: true
      datePublished:
        select: 'script[type="application/ld+json"]'
        jsonld: datePublished
        list: false
        first: true


The issue is the the heuristic for analyzing the document body got confused by a slideshow with lots of text. Not only do we want to correct this, but we want to make sure that slideshow text doesn't get included in the output - this can be done with `removes`

	...
    extract:
      document:
        select: article
        content: p
        removes: div.upi-slider.story_sl
	...

Run this command 

	node extract --url $URL --rule rule.yaml

And we get

    --
    datePublished: '2020-11-04T03:00:08-05:00'
    document: >-
    ORLANDO, Fla., Nov. 4 (UPI) -- Small launch company Rocket Lab has a big
    agenda for the end of 2020, including plans for its first liftoff from U.S.
    soil and its first attempt to recover a first-stage booster after launch.
    
    The California-based company, known for launching in New Zealand, is on target
    to tackle both goals this year, founder and CEO Peter Beck said in an
    interview Tuesday.
    
    ...
        
    The first attempt to recover a booster, still intended for 2020, will be on a
    flight with a paying customer, but none of the systems needed for booster
    recovery will be activated until the payload is deployed, Beck said.
    name: Small rocket company Rocket Lab aims for orbital reusability
    url: >-
    https://www.upi.com/Science_News/2020/11/04/Small-rocket-company-Rocket-Lab-aims-for-orbital-reusability/3961604426951/
